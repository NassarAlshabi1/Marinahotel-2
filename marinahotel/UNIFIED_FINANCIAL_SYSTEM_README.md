# النظام المالي الموحد - فندق مارينا

## نظرة عامة

تم تطوير النظام المالي الموحد لفندق مارينا لتوحيد جميع البيانات المالية وتوفير تقارير شاملة ومتقدمة. يجمع النظام بين الإيرادات والمصروفات وإدارة الصندوق والرواتب في واجهة موحدة سهلة الاستخدام.

## المكونات الرئيسية

### 1. الداشبورد المالي الموحد
**الملف:** `admin/finance/unified_financial_dashboard.php`

**الميزات:**
- عرض الإحصائيات المالية في الوقت الفعلي
- بطاقات ملخص للإيرادات والمصروفات وصافي الربح
- معدل الإشغال ومتوسط مدة الإقامة
- فلاتر تاريخية متقدمة
- تقارير تفصيلية حسب طريقة الدفع ونوع الإيراد
- حركة الصندوق اليومية
- تصدير PDF وExcel

### 2. قائمة الخدمات المالية
**الملف:** `admin/finance/financial_menu.php`

**الميزات:**
- واجهة مركزية لجميع الخدمات المالية
- إحصائيات سريعة (إيرادات اليوم، الشهر، معدل الإشغال)
- روابط منظمة للتقارير والمصروفات والمدفوعات
- أدوات التصدير والطباعة
- روابط سريعة للوظائف الأساسية

### 3. التقارير المالية الشاملة
**الملف:** `admin/reports/comprehensive_financial_reports.php`

**الميزات:**
- تقارير متعددة الفئات:
  - تقارير الإيرادات (يومية، حسب الغرف، طرق الدفع)
  - تقارير المصروفات (يومية، حسب النوع، الموردين)
  - التقارير التشغيلية (الإشغال، النزلاء، أداء الغرف)
  - تقارير التدفق النقدي (الصندوق، المعاملات)
- فلاتر متقدمة حسب التاريخ ونوع التقرير
- تصدير شامل بصيغ PDF وExcel

### 4. نظام التصدير المتقدم
**الملفات:** 
- `admin/finance/export_unified_report.php`
- `admin/reports/export_comprehensive_reports.php`

**الميزات:**
- تصدير PDF مع دعم النصوص العربية
- تصدير Excel مع تنسيق متقدم
- تقارير شاملة تتضمن جميع البيانات المالية
- إحصائيات مفصلة للغرف والنزلاء

## إصلاحات الهيدر

### المشاكل التي تم حلها:
1. **إضافة الهيدر المفقود** في الملفات التالية:
   - `admin/reports/revenue.php`
   - `admin/bookings/add2.php`
   - وملفات أخرى كانت تفتقر للتنسيق الصحيح

2. **إصلاح مسارات الأصول:**
   - تحديث `BASE_URL` في `includes/config.php` لتحديد المسار تلقائياً
   - إصلاح مسارات CSS وJavaScript

3. **توحيد نظام التضمين:**
   - استخدام `require_once` للملفات الأساسية
   - ترتيب صحيح لتضمين الملفات (header, auth_check, db)

## البيانات المالية الموحدة

### مصادر البيانات:
1. **الإيرادات:** جدول `payment`
   - المدفوعات حسب طريقة الدفع
   - تصنيف الإيرادات (غرف، مطعم، خدمات)
   - ربط مع بيانات الحجوزات والغرف

2. **المصروفات:** جدول `expenses`
   - تصنيف المصروفات حسب النوع
   - ربط مع الموردين
   - تتبع المشتريات والفواتير

3. **الرواتب:** جدول `salary_withdrawals`
   - سحوبات الموظفين
   - ربط مع بيانات الموظفين

4. **الصندوق:** جداول `cash_register` و `cash_transactions`
   - حركة الصندوق اليومية
   - المعاملات النقدية التفصيلية

### الحسابات المالية:
- **إجمالي الإيرادات:** مجموع جميع المدفوعات
- **إجمالي المصروفات:** مجموع المصروفات + الرواتب
- **صافي الربح:** الإيرادات - المصروفات - الرواتب
- **معدل الإشغال:** (الغرف المشغولة / إجمالي الغرف) × 100

## الاستخدام

### الوصول للنظام:
1. **الداشبورد الرئيسي:** `/admin/finance/financial_menu.php`
2. **التقارير المالية:** `/admin/finance/unified_financial_dashboard.php`
3. **التقارير الشاملة:** `/admin/reports/comprehensive_financial_reports.php`

### الفلاتر المتاحة:
- **نطاق التاريخ:** من تاريخ - إلى تاريخ
- **نوع التقرير:** ملخص، تفصيلي، إيرادات فقط، مصروفات فقط
- **فئة التقرير:** نظرة عامة، إيرادات، مصروفات، تشغيلي، تدفق نقدي

### التصدير:
- **PDF:** تقارير منسقة مع دعم العربية
- **Excel:** جداول تفصيلية قابلة للتحليل
- **طباعة:** تنسيق محسن للطباعة

## الأمان والصلاحيات

- **التوثيق المطلوب:** جميع الصفحات تتطلب تسجيل دخول
- **فحص الصلاحيات:** التحقق من صلاحيات الوصول للبيانات المالية
- **حماية البيانات:** استخدام prepared statements لمنع SQL injection
- **تسجيل العمليات:** تتبع الوصول للتقارير المالية

## التحسينات المستقبلية

1. **الرسوم البيانية:** إضافة charts تفاعلية
2. **التنبيهات:** تنبيهات للمؤشرات المالية المهمة
3. **التحليل التنبؤي:** توقعات الإيرادات والمصروفات
4. **التكامل مع الموبايل:** واجهة محسنة للهواتف الذكية
5. **التصدير المتقدم:** المزيد من صيغ التصدير والتخصيص

## الدعم الفني

للحصول على الدعم أو الإبلاغ عن مشاكل:
- تحقق من ملف `header_fixes_report.txt` لمعرفة حالة إصلاحات الهيدر
- راجع سجلات النظام في مجلد `logs/`
- استخدم `system_health_report.php` لفحص صحة النظام

---

**تاريخ آخر تحديث:** <?= date('Y-m-d') ?>
**الإصدار:** 2.0.0
**المطور:** DevloAI Bot